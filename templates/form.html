{% extends "base_public.html" %}{% set title="Formulaire d'habilitation" %}
{% block content %}
{% if trainers|length == 0 or formations|length == 0 %}
<div class="card">
  <p><strong>Configuration requise.</strong></p>
  <p>Un administrateur root doit d'abord créer au moins :</p>
  <ul><li>un formateur</li><li>une formation (Formation + Engagement)</li></ul>
</div>
{% else %}
<form method="post" action="{{ url_for('submit') }}" id="mainForm">
  <div class="grid">
    <label>Nom*<input name="nom" required></label>
    <label>Prénom*<input name="prenom" required></label>
    <label>Email*<input name="email" type="email" required></label>
    <label>Formateur*<select name="trainer_id" required>
      {% for t in trainers %}<option value="{{ t.id }}">{{ t.first_name }} {{ t.last_name }}</option>{% endfor %}
    </select></label>
    <label>Formation suivie*<select name="formation_id" required>
      {% for fo in formations %}<option value="{{ fo.id }}">{{ fo.name }}</option>{% endfor %}
    </select></label>
    <label>Date (facultatif)<input name="date_formation" type="date" value=""><small>Si vide, la date du jour sera enregistrée.</small></label>
  </div>
  <hr>
  <h2>Signatures</h2>
  <div class="sig-grid">
    <div class="sig-box">
      <h3>Signature de la personne habilitée*</h3>
      <canvas class="signature" id="sigForme" width="420" height="160"></canvas>
      <div class="sig-actions"><button type="button" data-clear="sigForme">Effacer</button></div>
      <input type="hidden" name="signature_forme" id="sigFormeData">
    </div>
    <div class="sig-box">
      <h3>Signature du formateur*</h3>
      <canvas class="signature" id="sigFormateur" width="420" height="160"></canvas>
      <div class="sig-actions"><button type="button" data-clear="sigFormateur">Effacer</button></div>
      <input type="hidden" name="signature_formateur" id="sigFormateurData">
    </div>
  </div>
  <div class="actions"><button type="submit">Valider</button></div>
</form>
<script src="{{ url_for('static', filename='signature.js') }}"></script>
<script>
document.getElementById("mainForm").addEventListener("submit", function () {
  document.getElementById("sigFormeData").value = window.SignaturePad.getDataURL("sigForme");
  document.getElementById("sigFormateurData").value = window.SignaturePad.getDataURL("sigFormateur");
});
</script>
{% endif %}
{% endblock %}
